<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrito de Compras | Level Up Gamer</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root{
      --gamer-green: #39FF14;
      --gamer-green-dark: #28cc0f;
      --gamer-blue: #1E90FF;
      --bg-dark: #000;
      --muted: #d3d3d3;
    }

    body{ background: var(--bg-dark); color:#fff; font-family: 'Roboto', sans-serif; }

    .navbar{ background: #0b0b0b; border-bottom: 1px solid rgba(255,255,255,0.05); }

    /* Bot√≥n principal */
    .btn-gamer{
      background: var(--gamer-green) !important;
      color: #000 !important;
      border: none !important;
      font-weight: 700;
      border-radius: 10px;
      transition: all .2s ease;
    }
    .btn-gamer:hover, .btn-gamer:focus{
      background: var(--gamer-green-dark) !important;
      color: #fff !important;
      transform: translateY(-1px);
      box-shadow: 0 0 15px rgba(57,255,20,0.4);
    }

    /* Cards de productos */
    .card{ background: #0c0c0c; border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card:hover{ transform: translateY(-6px); box-shadow: 0 0 20px rgba(57,255,20,0.4); }
    .card-title{ color: #fff; font-family: 'Orbitron', sans-serif; }
    .card-text{ color: #cfcfcf; }

    .card .btn-gamer{ padding: .4rem .7rem; font-size: .9rem; }

    /* Offcanvas carrito */
    .offcanvas{ background: #0a0a0a; color:#fff; }
    .list-group-item{ background: transparent; border: none; color: #fff; }

    .price{ color: var(--gamer-green); font-weight: 700; }
    .small-muted{ color: #bdbdbd; font-size: .85rem; }

    .btn-outline-light{ border-color: rgba(255,255,255,0.2); color: #fff; }
    .btn-outline-light:hover{ background: var(--gamer-blue); border-color: var(--gamer-blue); }

    footer{ background: #0b0b0b; color:#bdbdbd; padding: 3rem 0; margin-top: 4rem; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="assets/logo_gamer.png" alt="logo" width="40" class="me-2">
        <span class="fw-bold text-uppercase" style="font-family:Orbitron, sans-serif; color:var(--gamer-blue)">Level Up Gamer</span>
      </a>

      <div class="d-flex ms-auto">
        <button class="btn btn-gamer" type="button" data-bs-toggle="offcanvas" data-bs-target="#carrito" aria-controls="carrito">
          <i class="bi bi-cart4"></i>
          Carrito <span id="cartCount" class="badge bg-dark text-white ms-2">0</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="py-5 mt-4">
    <div class="container">
      <header class="text-center mb-5">
        <h1 class="display-5 fw-bold text-primary" style="font-family:Orbitron, sans-serif">Cat√°logo de Productos</h1>
        <p class="text-secondary">Explora nuestra selecci√≥n gamer y agrega tus favoritos al carrito üéÆ</p>
      </header>

      <div class="row g-4">
        <div class="col-12 col-sm-6 col-lg-4">
          <div class="card h-100">
            <img src="assets/img/cartasGamer.png" class="card-img-top" alt="Juego de Cartas">
            <div class="card-body text-center">
              <h5 class="card-title">Juego de Cartas Gamer</h5>
              <p class="card-text">$24.990</p>
              <button class="btn btn-gamer add-to-cart" type="button"><i class="bi bi-cart-plus"></i> Agregar</button>
            </div>
          </div>
        </div>

        <div class="col-12 col-sm-6 col-lg-4">
          <div class="card h-100">
            <img src="assets/img/headset.png" class="card-img-top" alt="Headset Gamer">
            <div class="card-body text-center">
              <h5 class="card-title">Headset Gamer</h5>
              <p class="card-text">$49.990</p>
              <button class="btn btn-gamer add-to-cart" type="button"><i class="bi bi-cart-plus"></i> Agregar</button>
            </div>
          </div>
        </div>

        <div class="col-12 col-sm-6 col-lg-4">
          <div class="card h-100">
            <img src="assets/img/mouse.png" class="card-img-top" alt="Mouse RGB">
            <div class="card-body text-center">
              <h5 class="card-title">Mouse RGB</h5>
              <p class="card-text">$29.990</p>
              <button class="btn btn-gamer add-to-cart" type="button"><i class="bi bi-cart-plus"></i> Agregar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Offcanvas Carrito -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="carrito" aria-labelledby="carritoLabel">
    <div class="offcanvas-header border-bottom border-secondary">
      <h5 class="offcanvas-title fw-bold text-primary" id="carritoLabel"><i class="bi bi-cart4"></i> Carrito de Compras</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <ul id="cartItems" class="list-group list-group-flush mb-3">
        <li class="list-group-item small-muted">Tu carrito est√° vac√≠o.</li>
      </ul>

      <div class="mt-auto border-top border-secondary pt-3">
        <h6 class="d-flex justify-content-between align-items-center">
          <span>Total:</span>
          <span id="cartTotal" class="price">$0</span>
        </h6>
        <div class="d-grid gap-2 mt-3">
          <button id="checkoutBtn" class="btn btn-gamer"><i class="bi bi-credit-card"></i> Finalizar Compra</button>
          <button id="clearBtn" class="btn btn-outline-light">Vaciar Carrito</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center small">
    <div class="container">
      <p class="mb-0">&copy; <span id="year"></span> Level Up Gamer ‚Äî Todos los derechos reservados.</p>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const KEY = 'carritoLevelUp_v1';
    let carrito = [];

    const cartItemsEl = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartCountEl = document.getElementById('cartCount');

    function parsePrice(text){
      const cleaned = text.replace(/[^0-9]/g,'');
      return parseInt(cleaned)||0;
    }

    function formatPrice(n){
      return n.toLocaleString('es-CL');
    }

    function saveCart(){ localStorage.setItem(KEY, JSON.stringify(carrito)); }
    function loadCart(){ carrito = JSON.parse(localStorage.getItem(KEY) || '[]'); }

    function renderCart(){
      cartItemsEl.innerHTML = '';
      if(carrito.length === 0){
        cartItemsEl.innerHTML = '<li class="list-group-item small-muted">Tu carrito est√° vac√≠o.</li>';
        cartTotalEl.textContent = '$0';
        cartCountEl.textContent = '0';
        return;
      }
      carrito.forEach((item,index) => {
        const subtotal = item.unitPrice * item.qty;
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-start';
        li.innerHTML = `
          <div class="ms-2 me-auto">
            <div class="fw-bold">${item.name}</div>
            <div class="small-muted">Unidad: $${formatPrice(item.unitPrice)} ¬∑ Cant: ${item.qty}</div>
          </div>
          <div class="text-end">
            <div class="price">$${formatPrice(subtotal)}</div>
            <div class="btn-group mt-2" role="group">
              <button class="btn btn-sm btn-outline-light" onclick="decreaseItem(${index})">-</button>
              <button class="btn btn-sm btn-outline-light" onclick="increaseItem(${index})">+</button>
              <button class="btn btn-sm btn-outline-danger ms-2" onclick="removeItem(${index})"><i class="bi bi-trash"></i></button>
            </div>
          </div>`;
        cartItemsEl.appendChild(li);
      });
      const total = carrito.reduce((s,i)=> s + i.unitPrice * i.qty,0);
      cartTotalEl.textContent = `$${formatPrice(total)}`;
      cartCountEl.textContent = carrito.reduce((s,i)=> s+i.qty,0);
    }

    function addProduct(name,price){
      const idx = carrito.findIndex(p=>p.name===name);
      if(idx>=0){ carrito[idx].qty++; }
      else{ carrito.push({name,unitPrice:price,qty:1}); }
      saveCart(); renderCart();
    }

    function decreaseItem(index){
      carrito[index].qty--;
      if(carrito[index].qty<=0) carrito.splice(index,1);
      saveCart(); renderCart();
    }

    function increaseItem(index){ carrito[index].qty++; saveCart(); renderCart(); }
    function removeItem(index){ carrito.splice(index,1); saveCart(); renderCart(); }
    function clearCart(){ carrito=[]; saveCart(); renderCart(); }

    document.addEventListener('DOMContentLoaded',()=>{
      loadCart(); renderCart();
      document.querySelectorAll('.add-to-cart').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const card = btn.closest('.card');
          const name = card.querySelector('.card-title').textContent.trim();
          const price = parsePrice(card.querySelector('.card-text').textContent);
          addProduct(name,price);
          bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('carrito')).show();
        });
      });
      document.getElementById('clearBtn').addEventListener('click',()=>{ if(confirm('¬øVaciar carrito?')) clearCart(); });
      document.getElementById('checkoutBtn').addEventListener('click',()=>{
        if(carrito.length===0){ alert('Tu carrito est√° vac√≠o'); return; }
        const total = carrito.reduce((s,i)=>s+i.unitPrice*i.qty,0);
        alert(`Total a pagar: $${formatPrice(total)}\n\n(Integraci√≥n de pago pendiente)`);
        clearCart();
      });
    });
  </script>
</body>
</html>